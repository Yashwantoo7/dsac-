$(function(){if(typeof statsUpdateInterval==="undefined"||statsUpdateInterval==null){statsUpdateInterval=30}$("body").on("click",".play-videojs-list",function(e){e.preventDefault();createVideoJs();let id=$(this).attr("data-id");let section=$(this).attr("data-section");let videoDetails=returnVideoDetails(section,id);playClassroomCourseVideo(videoDetails["url"],section,id,true);window.location.hash="";$("#current-video-description").html($.parseHTML(videoDetails["description"]));$("#video-playlist-wrapper").html(videoPlaylistTemplate(section,trackVideosProgressData));$(".video-playlist-item[data-src="+id+"]").addClass("video-item-active");$(".video-playlist-item[data-src="+id+"] .fa-custom_icon").removeClass("fa-play-circle-o").addClass("fa-pause");$("#learnVideoModal").append('<div class="forwardIcon text-center" style="display:none; position: absolute;top: 44%;left: 80%; z-index: 9999; font-size:25px;"><i class="fa fa-forward"></i><span style="margin-bottom:50%"> 10</span></div><div class="backwardIcon text-center" style="display:none;position: absolute;top: 44%;left: 10%;z-index: 9999; font-size:25px;">10 <i class="fa fa-backward"></i></div><div class="volumeIcon text-center" style="position: absolute;z-index: 9999;top: 10%; left: 80%;font-size: 20px;"></div>');setTimeout(function(){$("#learnVideoModal").focus()},500);$("#learnVideoModal").attr("data-gfg-video-id",id);$("#current-video-description > p").css("padding","0px 10px");$("h4, p").filter(function(){return $.trim($(this).text().trim()).length===0}).remove()});$("body").on("click",".video-playlist-item",function(e){e.preventDefault();$(".video-playlist-item").removeClass("video-item-active").addClass("pe-none");$(".video-playlist-item .fa-custom_icon").removeClass("fa-pause").addClass("fa-play-circle-o");$(this).addClass("video-item-active");let id=$(this).attr("data-src");let section=$(this).attr("data-section");let videoDetails=returnVideoDetails(section,id);if(parseInt(videoDetails["type"])==1){createVideoJs();$(this).find(".fa-custom_icon").removeClass("fa-play-circle-o").addClass("fa-pause");$(".video-inner-src").css("opacity","0.2");$("#loader").removeClass("hide").css("display","block!important");$("#cancelPlayVideo").hide();$("#current-video-description").html("");setTimeout(()=>{$("#loader").addClass("hide");$("#cancelPlayVideo").show();$(".video-inner-src").css("opacity","1");playClassroomCourseVideo(videoDetails["url"],section,id,false);$("#current-video-description").html($.parseHTML(videoDetails["description"]));$("h4, p").filter(function(){return $.trim($(this).text().trim()).length===0}).remove();$("#current-video-description > p").css("padding","0px 10px");$(".video-playlist-item").removeClass("pe-none");$("#learnVideoModal").append('<div class="forwardIcon text-center" style="display:none; position: absolute;top: 44%;left: 80%; z-index: 9999; font-size:25px;"><i class="fa fa-forward"></i><span style="margin-bottom:50%"> 10</span></div><div class="backwardIcon text-center" style="display:none;position: absolute;top: 44%;left: 10%;z-index: 9999; font-size:25px;">10 <i class="fa fa-backward"></i></div><div class="volumeIcon text-center" style="position: absolute;z-index: 9999;top: 10%; left: 80%;font-size: 20px;"></div>');$("#learnVideoModal").attr("data-gfg-video-id",id)},1e3);setTimeout(function(){$("#learnVideoModal").focus()},500)}else{let elIndex=findElementIndex(id,section);window.location.hash=`trackTitle_${section}_${elIndex}`;$("#learnVideo").modal("hide");$(`#trackTitle_${section}_${elIndex}`).collapse("show")}});$("#learnVideo").on("hidden.bs.modal",function(){currentPlayer.pause();currentPlayer.reset()})});function playClassroomCourseVideo(url,section,id,show=true){var videoPlayerSavedSettings={};let level=JSON.parse(sessionStorage.getItem("videoPlayerSavedSettings"));currentPlayer=undefined;currentPlayer=videojs("learnVideoModal",{playbackRates:[.5,.75,1,1.25,1.5,2],html5:{nativeAudioTracks:false,nativeVideoTracks:false,hls:{debug:true,overrideNative:true,enableLowInitialPlaylist:true,smoothQualityChange:true}}},function(){$.each(level,function(key,value){if(key=="gfgVolumebar"){if(typeof value!=undefined&&value!==null){currentPlayer.volume(value)}}if(key=="gfgIsMute"){if(typeof value!=undefined&&value!==null&&value==true){$(".vjs-tech").prop("muted",true);videoPlayerSavedSettings["gfgIsMute"]=true;sessionStorage.setItem("videoPlayerSavedSettings",JSON.stringify(videoPlayerSavedSettings))}}})});currentPlayer.ready(function(){this.src({src:url,type:"application/x-mpegURL",withCredentials:false});currentPlayer.hlsQualitySelector({});currentPlayer.play();this.hotkeys({volumeStep:.1,seekStep:10,enableModifiersForNumbers:false,alwaysCaptureHotkeys:true,forwardKey:function(event,player){if(event.which==39){$(".forwardIcon").show().delay(10).fadeOut();setTimeout(function(){$("#learnVideoModal").focus()},500)}return event.which==39},rewindKey:function(event,player){if(event.which==37){$(".backwardIcon").show().delay(10).fadeOut();setTimeout(function(){$("#learnVideoModal").focus()},500)}return event.which==37},volumeUpKey:function(event,player){if(event.which==38){var currentVolume=$(".vjs-volume-bar").attr("aria-valuenow");$(".volumeIcon").html('<i class="fa fa-volume-up"></i> '+currentVolume+"%");$(".volumeIcon").show().delay(50).fadeOut();setTimeout(function(){$("#learnVideoModal").focus()},500)}return event.which==38},volumeDownKey:function(event,player){if(event.which==40){$(".volumeIcon").html('<i class="fa fa-volume-down"></i> '+$(".vjs-volume-bar").attr("aria-valuenow")+"%");$(".volumeIcon").show().delay(50).fadeOut();setTimeout(function(){$("#learnVideoModal").focus()},500)}return event.which==40}})});currentPlayer.one("play",function(e){if(trackVideosProgressData&&trackVideosProgressData!={}&&id in trackVideosProgressData&&trackVideosProgressData[id]&&trackVideosProgressData[id]!=undefined){var watchedTime=parseInt(trackVideosProgressData[id].watched_time);var totalDuration=parseInt(trackVideosProgressData[id].total_duration);var remainingTime=totalDuration-watchedTime;if(remainingTime>statsUpdateInterval){currentPlayer.currentTime(watchedTime)}}$.each(level,function(key,value){if(key=="gfgRatebar"){if(typeof value!=undefined&&value!==null){currentPlayer.playbackRate(value)}}});var content='<style>.video-js:before{content: "'+user_email+'";}</style>';$("head").append(content);var watermark_align=["top-left","forth-quad","second-quad","bottom-right","center-left","top-right","third-quad","center-right","center-top","bottom-left","center","first-quad","center-bottom"];var counter=0;setInterval(function(){if(counter){currentPlayer.removeClass(watermark_align[counter-1])}else{currentPlayer.removeClass(watermark_align[watermark_align.length-1])}if(counter>=watermark_align.length){counter=0}currentPlayer.addClass(watermark_align[counter]);counter++},5e4)});var lastUpdateTime=0;currentPlayer.on("timeupdate",function(e){var whereUserAt=currentPlayer.currentTime();var ceilTime=Math.ceil(whereUserAt);var totalDuration=Math.ceil(currentPlayer.duration());var watchedPercentage=parseInt(ceilTime*100/totalDuration);$("#gfg-video-progress-"+id).css({display:"block",width:`${watchedPercentage}%`});if((ceilTime%statsUpdateInterval==0||Math.abs(ceilTime-lastUpdateTime)>statsUpdateInterval)&&String(ceilTime)!=String(lastUpdateTime)){lastUpdateTime=ceilTime;$.ajax({type:"POST",url:"/user-course/stats/",data:{requestType:"saveUserVideoProgress",utoken:$("#utoken").text(),videoId:btoa(id),batchId:btoa(batchId),totalDuration:totalDuration,watchedTime:ceilTime},success:function(result){var response=result;var status=response["success"];if(status==true){if(id in trackVideosProgressData){trackVideosProgressData[id]["watched_time"]=ceilTime}else{trackVideosProgressData[id]={watched_time:ceilTime,total_duration:totalDuration}}}}})}});currentPlayer.on("error",function(e){errorHandling(e,"learnVideo",currentPlayer)});currentPlayer.on("ratechange",function(){setTimeout(function(){$("#learnVideoModal").focus()},500);videoPlayerSavedSettings["gfgRatebar"]=currentPlayer.playbackRate();sessionStorage.setItem("videoPlayerSavedSettings",JSON.stringify(videoPlayerSavedSettings))});currentPlayer.on("volumechange",function(){if(currentPlayer.volume()!==null||currentPlayer.volume()!==undefined){videoPlayerSavedSettings["gfgVolumebar"]=currentPlayer.volume();sessionStorage.setItem("videoPlayerSavedSettings",JSON.stringify(videoPlayerSavedSettings))}});$(".vjs-mute-control").on("click",function(e){if($(".vjs-tech").prop("muted")){videoPlayerSavedSettings["gfgIsMute"]=true}else{videoPlayerSavedSettings["gfgIsMute"]=false}sessionStorage.setItem("videoPlayerSavedSettings",JSON.stringify(videoPlayerSavedSettings))});currentPlayer.on("ended",function(){if(videoPlaylistArr[section]&&parseInt(videoPlaylistArr[section][videoPlaylistArr[section].length-1]["id"])!=id*1&&nextVideoIndex(section,id)!=-1){$("#loader").removeClass("hide").css("display","block!important");$(".video-inner-src").css("opacity","0.55")}else{section=null;id=null;return}$("#cancelPlayVideo").on("click",function(e){id=null;section=null;$("#loader").addClass("hide");$(".video-inner-src").css("opacity","1");return});setTimeout(()=>{if(section&&id&&videoPlaylistArr[section]&&parseInt(videoPlaylistArr[section][videoPlaylistArr[section].length-1]["id"])!=id*1&&nextVideoIndex(section,id)!=-1){playNextVideo(section,id)}id=null;section=null},3e3)});if(show){$("#learnVideo").modal("show")}}function returnVideoDetails(section,id){let data=videoPlaylistArr[section].find(obj=>{return obj["id"]==id});return data}function videoPlaylistTemplate(section,trackVideosProgressData){let template="";videoPlaylistArr[section].forEach(o=>{if(o.id){template+=`<li class="list-group-item playlist-card video-playlist-item" data-src="${o.id}" data-section="${section}">\n                                <p style="padding: 0px">`;if(o.type==1){template+=`<span class="fa fa-play-circle-o fa-custom_icon"></span>&nbsp;`}else if(o.type==0){template+=`<span class="fa fa-file-o"></span>&nbsp;`}template+=`  <span style="font-size: 13px">${o.title.replace("Video -","")}</span>\n                              </p>`;if(o.type==1){var watchTime=0;var display="none";if(o.id in trackVideosProgressData&&trackVideosProgressData[o.id].watched_percentage>0){var watchTime=trackVideosProgressData[o.id].watched_percentage;var display="block"}template+=` <div class="video-progress--light-grey"> \n                    <div class="video-progress-container video-progress-bar" id="gfg-video-progress-${o.id}" style="display:${display}; width:${watchTime}%"></div> </div>`}template+=`</li>`}});return template}function playNextVideo(section,id){let nextIndex=nextVideoIndex(section,id);if(nextIndex&&nextIndex!=-1){$(`.video-playlist-item[data-section=${section}][data-src=${videoPlaylistArr[section][nextIndex]["id"]}]`).click()}else{currentPlayer.pause();currentPlayer.reset();$("#loader").addClass("hide");$("#cancelPlayVideo").show();$(".video-inner-src").css("opacity","1")}}function findElementIndex(id,section){let index=videoPlaylistArr[section].findIndex(o=>{return o.id==id});return index!=null||index!=undefined?index:-1}function nextVideoIndex(section,currentId){if(videoPlaylistArr[section]&&videoPlaylistArr[section].length&&videoPlaylistArr[section][videoPlaylistArr[section].length-1]["id"]!=currentId*1){let index=findElementIndex(currentId,section);let videoDetails=index!=-1?videoPlaylistArr[section][index+1]:null;if(!videoDetails||videoDetails["type"]!=1){return-1}return index+1}else{return-1}}function createVideoJs(src){disposePlayer(true);var videoDiv=document.getElementById("video-src");var video=document.createElement("video");video.id="learnVideoModal";video.className="video-js video-inner-src vjs-default-skin";video.setAttribute("controls","controls");video.setAttribute("autoplay","autoplay");video.setAttribute("oncontextmenu","return false;");video.setAttribute("style","width: 100%!important; padding-left: 0px; padding-right: 0px");videoDiv.appendChild(video)}function disposePlayer(dispose=true){if(currentPlayer&&currentPlayer!=undefined&&dispose){currentPlayer.dispose()}}function errorHandling(e,modalId,curPlayer){e.stopImmediatePropagation();var errorObj=curPlayer.player().error();$("#gfg-snackbar").text(errorObj.message).addClass("show");setTimeout(()=>{$("#gfg-snackbar").removeClass("show").addClass("hide");$("#"+modalId).modal("hide")},3e3)}